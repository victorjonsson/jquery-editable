/*
 * jQuery plugin that makes elements editable
 *
 * @author Victor Jonsson (http://victorjonsson.se/)
 * @website https://github.com/victorjonsson/jquery-editable/
 * @license GPLv2 http://www.gnu.org/licenses/gpl-2.0.html
 * @version 1.3.5
 * @donations http://victorjonsson.se/donations/
 */!function(l,t){"use strict";function e(){var t=(new Date).getTime();t-p<250&&l(this).trigger(o),p=t}function a(t){if(13==t.keyCode&&t.data.closeOnEnter||27==t.keyCode&&t.data.closeOnEsc)f.editable("close");else if(t.data.toggleFontSize&&t.metaKey&&(38==t.keyCode||40==t.keyCode)){var e=parseInt(g.css("font-size"),10);return e+=40==t.keyCode?-1:1,g.css("font-size",e+"px"),!1}}function d(){g[0].scrollHeight!==parseInt(g.attr("data-scroll"),10)&&(g.css("height",g[0].scrollHeight+"px"),g.attr("data-scroll",g[0].scrollHeight))}function c(t,e,i){t.removeAttr(u),0==e.length&&i?(t.html(i),t.attr(y,"empty")):(t.html(e),t.removeAttr(y)),g.remove()}function i(s,o){var r,i,t,e,n;s.is(":editing")||((f=s).attr(u,"1"),s.is(":empty")&&(s.removeAttr(y),s.html("")),r=l.trim(s.html()),i=s.css("font-size"),t=s.height(),e="width: 96%; padding:0; margin:0; border:0; background:none;font-family: "+s.css("font-family")+"; font-size: "+s.css("font-size")+";font-weight: "+s.css("font-weight")+";",o.lineBreaks&&(r=r.replace(/<br( |)(|\/)>/g,"\n")),g=l("<textarea></textarea>"),s.text(""),null!==navigator.userAgent.match(/webkit/i)&&(e=document.defaultView.getComputedStyle(s.get(0),"").cssText),e+="position: static",!1!==o.tinyMCE?(n="editable-area-"+(new Date).getTime(),g.val(r).appendTo(s).attr("id",n),"object"!=typeof o.tinyMCE&&(o.tinyMCE={}),o.tinyMCE.mode="exact",o.tinyMCE.elements=n,o.tinyMCE.width=s.innerWidth(),o.tinyMCE.height=s.height()+200,o.tinyMCE.theme_advanced_resize_vertical=!0,o.tinyMCE.setup=function(t){t.onInit.add(function(e,t){var i=e.getWin(),n=!1,a=function(){var t=l(e.getDoc()).find("body").html();l(t).get(0).nodeName==s.get(0).nodeName&&(t=l(t).html()),c(s,t,o.emptyMessage),e.remove(),g=!1,h.unbind("click",a),f=!1,"function"==typeof o.callback&&o.callback({content:!(t==r||!n)&&t,fontSize:!1,$el:s})};setTimeout(function(){h.bind("click",a)},500),(g=l("<textarea></textarea>")).bind("blur",a),i.onkeydown=function(){n=!0},i.focus()})},tinyMCE.init(o.tinyMCE)):((o.toggleFontSize||o.closeOnEnter)&&h.bind("keydown",o,a),h.bind("keyup",d),g.val(r).blur(function(){f=!1;var t=l.trim(g.val()),e=g.css("font-size");o.lineBreaks&&(t=t.replace(new RegExp("\n","g"),"<br />")),c(s,t,o.emptyMessage),e!=i&&s.css("font-size",e),h.unbind("keydown",a),h.unbind("keyup",d),"function"==typeof o.callback&&o.callback({content:t!=r&&t,fontSize:e!=i&&e,$el:s})}).attr("style",e).appendTo(s).css({margin:0,padding:0,height:t+"px",overflow:"hidden"}).focus().get(0).select(),d()),s.trigger("edit",[g]))}function n(t){return!1!==f&&f.editable("close"),i(l(this),t.data),!1}var h=l(t),g=!1,f=!1,s="data-edit-event",u="data-is-editing",y="data-is-empty",o="dbltap",r="ontouchend"in t,b="tinyMCE"in t&&"function"==typeof t.tinyMCE.init,m=l.fn.is,p=0;l.fn.editable=function(t){if("string"==typeof t)if(this.is(":editable"))switch(t){case"open":this.is(":editing")||this.trigger(this.attr(s));break;case"close":this.is(":editing")&&g.trigger("blur");break;case"destroy":this.is(":editing")&&g.trigger("blur"),this.unbind(this.attr(s)),this.removeAttr(s);break;default:console.warn('Unknown command "'+t+'" for jquery.editable')}else console.error("Calling .editable() on an element that is not editable, call .editable() first");else this.is(":editable")&&(console.warn('Making an already editable element editable, call .editable("destroy") first'),this.editable("destroy")),!1===(t=l.extend({event:"dblclick",touch:!0,lineBreaks:!0,toggleFontSize:!0,closeOnEnter:!1,closeOnEsc:!0,emptyMessage:!1,tinyMCE:!1},t)).tinyMCE||b||(console.warn("Trying to use tinyMCE as editor but id does not seem to be installed"),t.tinyMCE=!1),r&&t.touch?(t.event=o,this.unbind("touchend",e),this.bind("touchend",e)):t.event+=".textEditor",this.bind(t.event,t,n),this.attr(s,t.event),0==this.html().length&&t.emptyMessage?(this.html(t.emptyMessage),this.attr(y,"empty")):this.removeAttr(y);return this},l.fn.is=function(t){if("string"==typeof t&&0===t.indexOf(":")){if(":editable"==t)return void 0!==this.attr(s);if(":editing"==t)return void 0!==this.attr(u);if(":empty"==t)return void 0!==this.attr(y)}return m.apply(this,arguments)}}(jQuery,window);